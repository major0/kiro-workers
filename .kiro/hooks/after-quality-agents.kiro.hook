{
  "name": "Consolidate Commits and Create PR",
  "version": "1.0.0",
  "description": "After quality agents complete, consolidate commits and create PR",
  "when": {
    "type": "agentStop"
  },
  "then": {
    "type": "askAgent",
    "prompt": "Check if the agent that just completed was running quality checks (look for recent commits with 'docs', 'test', or 'chore' types).\n\nIf YES and all 10 quality agents have completed:\n\nReference steering file: pr-submission-agent.md\n#[[file:.kiro/steering/pr-submission-agent.md]]\n\nThe steering file contains detailed instructions for:\n\n1. **Validate Completion**: Verify all 10 agents completed successfully\n2. **Mark Task Complete**: Use taskStatus tool to mark task as completed\n3. **Soft Reset**: \n   ```bash\n   git reset --soft origin/main\n   ```\n   This preserves all changes but removes commit history\n\n4. **Re-commit Cleanly**: Create consolidated commits:\n   ```bash\n   # Stage implementation files\n   git add <implementation-files>\n   git commit -m \"<type>(<scope>): <task-id> <task-title>\"\n   \n   # Stage test files\n   git add <test-files>\n   git commit -m \"test(<scope>): add comprehensive tests for <task-context>\"\n   \n   # Stage documentation files\n   git add <doc-files>\n   git commit -m \"docs(<scope>): update documentation for <task-context>\"\n   \n   # Stage quality fix files\n   git add <remaining-files>\n   git commit -m \"chore(<scope>): apply code quality fixes for <task-context>\"\n   ```\n\n5. **Push Branch**: \n   ```bash\n   git push origin <branch-name>\n   ```\n\n6. **Create PR**: \n   ```bash\n   gh pr create --title \"<generated-title>\" --body \"<generated-body>\" --base main\n   ```\n\n7. **Add Labels**: Based on commit types found\n\nIf NO (quality agents not done yet):\n   - Do nothing"
  }
}
