# Pre-commit hooks configuration for kiro-workers
# See https://pre-commit.com for more information

# Minimum pre-commit version
minimum_pre_commit_version: "2.20.0"

repos:
  # Standard pre-commit hooks for general file quality
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      # Remove trailing whitespace from all files
      - id: trailing-whitespace
        name: Trim trailing whitespace
        description: Removes trailing whitespace from all text files
        types: [text]

      # Ensure files end with a newline
      - id: end-of-file-fixer
        name: Fix end of files
        description: Ensures files end with a newline character
        types: [text]

      # Check YAML files for syntax errors
      - id: check-yaml
        name: Check YAML syntax
        description: Validates YAML file syntax
        types: [yaml]

      # Check JSON files for syntax errors
      - id: check-json
        name: Check JSON syntax
        description: Validates JSON file syntax
        types: [json]

      # Prevent large files from being committed
      - id: check-added-large-files
        name: Check for large files
        description: Prevents accidentally committing large files
        args: ["--maxkb=1000"]

      # Check for merge conflict markers
      - id: check-merge-conflict
        name: Check for merge conflicts
        description: Detects merge conflict markers in files

      # Check for files that would conflict on case-insensitive filesystems
      - id: check-case-conflict
        name: Check for case conflicts
        description: Checks for files with names that differ only in case

      # Ensure shell scripts are executable
      - id: check-executables-have-shebangs
        name: Check executables have shebangs
        description: Ensures executable scripts have proper shebangs

      # Ensure shell scripts have proper shebangs
      - id: check-shebang-scripts-are-executable
        name: Check shebang scripts are executable
        description: Ensures scripts with shebangs are executable

      # Detect private keys
      - id: detect-private-key
        name: Detect private keys
        description: Prevents committing private keys

      # Check for mixed line endings
      - id: mixed-line-ending
        name: Check for mixed line endings
        description: Ensures consistent line endings (LF)
        args: ["--fix=lf"]

  # Prettier for code formatting (TypeScript, JSON, YAML, Markdown)
  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v3.1.0
    hooks:
      - id: prettier
        name: Format with Prettier
        description: Formats TypeScript, JavaScript, JSON, YAML, and Markdown files
        types_or: [javascript, jsx, ts, tsx, json, yaml, markdown]
        args:
          - --write
          - --ignore-unknown
          - --config-precedence=prefer-file

  # ESLint for TypeScript/JavaScript linting
  - repo: https://github.com/pre-commit/mirrors-eslint
    rev: v8.56.0
    hooks:
      - id: eslint
        name: Lint with ESLint
        description: Lints TypeScript and JavaScript files
        types_or: [javascript, jsx, ts, tsx]
        args:
          - --fix
          - --max-warnings=0
        additional_dependencies:
          - eslint@8.56.0
          - "@typescript-eslint/eslint-plugin@6.21.0"
          - "@typescript-eslint/parser@6.21.0"
          - typescript@5.3.3

  # Markdownlint for Markdown files
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.39.0
    hooks:
      - id: markdownlint
        name: Lint Markdown files
        description: Lints Markdown files for style and formatting issues
        args:
          - --fix
          - --config=.markdownlint.json

  # Conventional Commits validation
  - repo: https://github.com/compilerla/conventional-pre-commit
    rev: v3.1.0
    hooks:
      - id: conventional-pre-commit
        name: Validate Conventional Commits
        description: Ensures commit messages follow Conventional Commits format
        stages: [commit-msg]
        args:
          - --force-scope
        verbose: true

  # Additional YAML linting with yamllint
  - repo: https://github.com/adrienverge/yamllint
    rev: v1.35.1
    hooks:
      - id: yamllint
        name: Lint YAML files
        description: Advanced YAML linting for style and best practices
        types: [yaml]
        args:
          - --strict
          - --config-file=.yamllint.yaml

  # TypeScript type checking (if tsconfig.json exists)
  - repo: local
    hooks:
      - id: typescript-check
        name: TypeScript type check
        description: Runs TypeScript compiler to check for type errors
        entry: bash -c 'if [ -f tsconfig.json ]; then npx tsc --noEmit; fi'
        language: system
        types: [ts, tsx]
        pass_filenames: false

  # Check for TODO/FIXME comments in production code
  - repo: local
    hooks:
      - id: check-todos
        name: Check for TODO/FIXME
        description: Warns about TODO/FIXME comments in code
        entry: bash
        args:
          [
            "-c",
            'if [ -d actions ] || [ -d shared ]; then grep -rn "TODO\|FIXME" --include="*.ts" --include="*.js" actions/ shared/ 2>/dev/null && echo "Warning: TODO/FIXME comments found" || true; fi',
          ]
        language: system
        pass_filenames: false
        verbose: true

# Configuration for specific file types
default_language_version:
  node: system
  python: python3

# Exclude patterns
exclude: |
  (?x)^(
    dist/.*|
    node_modules/.*|
    \.git/.*|
    \.kiro/.*|
    coverage/.*|
    .*\.min\.js|
    .*\.bundle\.js
  )$
